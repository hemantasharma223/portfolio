<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Visitors List</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f9f9f9; }
  table { border-collapse: collapse; width: 100%; background: white; }
  th, td { padding: 10px; border: 1px solid #ddd; text-align: left; }
  th { background-color: #4CAF50; color: white; }
  tr:nth-child(even) { background-color: #f2f2f2; }
  pre { white-space: pre-wrap; max-width: 300px; word-wrap: break-word; }
  #loading { font-weight: bold; }
</style>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<h1>Visitors Data</h1>

<div id="loading">Loading data, please wait...</div>
<table id="visitors-table" style="display:none;">
  <thead>
    <tr>
      <th>ID</th>
      <th>IP Address</th>
      <th>Country</th>
      <th>City</th>
      <th>ISP</th>
      <th>Timezone</th>
      <th>Browser Info</th>
      <th>Screen Resolution</th>
      <th>Visit Time</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
$(document).ready(function() {
  $.ajax({
    url: 'https://karkiandasuppliers.com/fetch_visitors.php',
    method: 'GET',
    dataType: 'json',
    success: function(data) {
      if(data.error) {
        $('#loading').text('Error loading data: ' + data.error);
        return;
      }
      if(data.length === 0) {
        $('#loading').text('No visitor data found.');
        return;
      }

      $('#loading').hide();
      $('#visitors-table').show();

      data.forEach(function(v) {
        // Parse geo_json safely
        var geo = {};
        try {
          geo = JSON.parse(v.geo_json) || {};
        } catch(e) {}

        var country = geo.country || '';
        var city = geo.city || '';
        var isp = geo.isp || '';
        var timezone = geo.timezone || '';

        var browserInfo = v.browser_info || '';
        var screenRes = v.screen_resolution || '';
        var visitTime = v.visit_time || '';

        var row = '<tr>' +
          '<td>' + v.id + '</td>' +
          '<td>' + v.ip_address + '</td>' +
          '<td>' + country + '</td>' +
          '<td>' + city + '</td>' +
          '<td>' + isp + '</td>' +
          '<td>' + timezone + '</td>' +
          '<td><pre>' + $('<div>').text(browserInfo).html() + '</pre></td>' +
          '<td>' + screenRes + '</td>' +
          '<td>' + visitTime + '</td>' +
          '</tr>';
        $('#visitors-table tbody').append(row);
      });
    },
    error: function(xhr, status, error) {
      $('#loading').text('Failed to load data: ' + error);
    }
  });
});
</script>
</body>
</html>
